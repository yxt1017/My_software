<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è‰ºæœ¯çš„å¯ç¤º - å§“åæ‹¼éŸ³è‡ªåŠ¨å¡«å……</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pinyin-pro/3.13.2/index.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background-color: #f4f7f6; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; }
        h2 { color: #333; }
        input { margin: 20px 0; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; }
        button:disabled { background-color: #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ¨ å§“åæ‹¼éŸ³è‡ªåŠ¨å¡«å……å·¥å…·</h2>
        <p>è¯·ä¸Šä¼  .xlsx æ–‡ä»¶ï¼ˆBåˆ—ä¸­æ–‡å -> Cåˆ—æ‹¼éŸ³ï¼‰</p>
        <input type="file" id="upload" accept=".xlsx" /><br>
        <button id="processBtn" disabled>å¼€å§‹å¤„ç†å¹¶ä¸‹è½½</button>
    </div>

    <script>
        const { pinyin } = pinyinPro;
        let workbookData = null;
        let fileName = "";

        // æ ¸å¿ƒé€»è¾‘ï¼šå‰ä¸¤ä¸ªå­—é¦–å­—æ¯å¤§å†™ï¼Œåç»­å°å†™
        function convertToPinyin(name) {
            if (!name) return "";
            // å°†å§“åæ‹†åˆ†ä¸ºå•ä¸ªæ±‰å­—çš„æ‹¼éŸ³æ•°ç»„
            const pinyinArray = pinyin(name, { type: 'array', toneType: 'none' });
            
            return pinyinArray.map((py, index) => {
                if (index < 2) {
                    // å‰ä¸¤ä¸ªå­—é¦–å­—æ¯å¤§å†™
                    return py.charAt(0).toUpperCase() + py.slice(1).toLowerCase();
                } else {
                    // åç»­å­—å…¨å°å†™
                    return py.toLowerCase();
                }
            }).reduce((acc, curr, idx) => {
                // å§“(ç¬¬ä¸€ä¸ªå­—)åé¢åŠ ç©ºæ ¼ï¼Œå…¶ä½™è¿å†™
                return idx === 1 ? acc + " " + curr : acc + curr;
            });
        }

        document.getElementById('upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            fileName = file.name;
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                workbookData = XLSX.read(data, { type: 'array' });
                document.getElementById('processBtn').disabled = false;
            };
            reader.readAsArrayBuffer(file);
        });

        document.getElementById('processBtn').addEventListener('click', function() {
            const sheetName = workbookData.SheetNames[0];
            const worksheet = workbookData.Sheets[sheetName];
            
            // å°†è¡¨æ ¼è½¬ä¸º JSON å¤„ç†
            const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            // ä»ç¬¬äºŒè¡Œå¼€å§‹å¤„ç† (index 1)
            for (let i = 1; i < rows.length; i++) {
                let chineseName = rows[i][1]; // Båˆ—
                if (chineseName && !String(chineseName).includes("å¿…å¡«")) {
                    rows[i][2] = convertToPinyin(String(chineseName)); // å†™å…¥Cåˆ—
                }
            }

            // å†™å› Excel
            const newWS = XLSX.utils.aoa_to_sheet(rows);
            const newWB = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(newWB, newWS, sheetName);
            
            // å¯¼å‡ºä¸‹è½½
            XLSX.writeFile(newWB, `ã€å·²å¡«å……ã€‘${fileName}`);
        });
    </script>
</body>
</html>
